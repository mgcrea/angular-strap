{"version":3,"file":"scrollspy.min.js","sources":["scrollspy\\scrollspy.js"],"names":["angular","module","provider","spies","this","$$spies","defaults","debounce","throttle","offset","$get","$window","$document","$rootScope","dimensions","nodeName","element","name","toLowerCase","ScrollSpyFactory","config","options","extend","bodyEl","isWindowSpy","scrollEl","windowEl","scrollId","id","$$count","unbindViewContentLoaded","unbindIncludeContentLoaded","activeTarget","debouncedCheckPosition","throttledCheckPosition","debouncedCheckOffsets","viewportHeight","scrollTop","$scrollspy","trackedElements","$trackedElements","sortedElements","init","checkPosition","on","checkPositionWithEventLoop","checkOffsets","$on","destroy","off","length","pageYOffset","prop","Math","max","innerHeight","docEl","offsetTop","target","$activateElement","i","isUndefined","setTimeout","activeElement","$getTrackedElement","source","removeClass","parent","addClass","filter","obj","forEach","trackedElement","targetElement","document","querySelector","top","el","sort","a","b","trackElement","push","untrackElement","toDelete","splice","activate","body","directive","restrict","link","scope","attr","key","isDefined","scrollspy","compile","children","querySelectorAll","child","childEl"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nangular.module('mgcrea.ngStrap.scrollspy', ['mgcrea.ngStrap.helpers.debounce', 'mgcrea.ngStrap.helpers.dimensions'])\r\n\r\n  .provider('$scrollspy', function() {\r\n\r\n    // Pool of registered spies\r\n    var spies = this.$$spies = {};\r\n\r\n    var defaults = this.defaults = {\r\n      debounce: 150,\r\n      throttle: 100,\r\n      offset: 100\r\n    };\r\n\r\n    this.$get = function($window, $document, $rootScope, dimensions, debounce, throttle) {\r\n\r\n      var windowEl = angular.element($window);\r\n      var docEl = angular.element($document.prop('documentElement'));\r\n      var bodyEl = angular.element($window.document.body);\r\n\r\n      // Helper functions\r\n\r\n      function nodeName(element, name) {\r\n        return element[0].nodeName && element[0].nodeName.toLowerCase() === name.toLowerCase();\r\n      }\r\n\r\n      function ScrollSpyFactory(config) {\r\n\r\n        // Common vars\r\n        var options = angular.extend({}, defaults, config);\r\n        if(!options.element) options.element = bodyEl;\r\n        var isWindowSpy = nodeName(options.element, 'body');\r\n        var scrollEl = isWindowSpy ? windowEl : options.element;\r\n        var scrollId = isWindowSpy ? 'window' : options.id;\r\n\r\n        // Use existing spy\r\n        if(spies[scrollId]) {\r\n          spies[scrollId].$$count++;\r\n          return spies[scrollId];\r\n        }\r\n\r\n        var $scrollspy = {};\r\n\r\n        // Private vars\r\n        var unbindViewContentLoaded, unbindIncludeContentLoaded;\r\n        var trackedElements = $scrollspy.$trackedElements = [];\r\n        var sortedElements = [];\r\n        var activeTarget;\r\n        var debouncedCheckPosition;\r\n        var throttledCheckPosition;\r\n        var debouncedCheckOffsets;\r\n        var viewportHeight;\r\n        var scrollTop;\r\n\r\n        $scrollspy.init = function() {\r\n\r\n          // Setup internal ref counter\r\n          this.$$count = 1;\r\n\r\n          // Bind events\r\n          debouncedCheckPosition = debounce(this.checkPosition, options.debounce);\r\n          throttledCheckPosition = throttle(this.checkPosition, options.throttle);\r\n          scrollEl.on('click', this.checkPositionWithEventLoop);\r\n          windowEl.on('resize', debouncedCheckPosition);\r\n          scrollEl.on('scroll', throttledCheckPosition);\r\n\r\n          debouncedCheckOffsets = debounce(this.checkOffsets, options.debounce);\r\n          unbindViewContentLoaded = $rootScope.$on('$viewContentLoaded', debouncedCheckOffsets);\r\n          unbindIncludeContentLoaded = $rootScope.$on('$includeContentLoaded', debouncedCheckOffsets);\r\n          debouncedCheckOffsets();\r\n\r\n          // Register spy for reuse\r\n          if(scrollId) {\r\n            spies[scrollId] = $scrollspy;\r\n          }\r\n\r\n        };\r\n\r\n        $scrollspy.destroy = function() {\r\n\r\n          // Check internal ref counter\r\n          this.$$count--;\r\n          if(this.$$count > 0) {\r\n            return;\r\n          }\r\n\r\n          // Unbind events\r\n          scrollEl.off('click', this.checkPositionWithEventLoop);\r\n          windowEl.off('resize', debouncedCheckPosition);\r\n          scrollEl.off('scroll', debouncedCheckPosition);\r\n          unbindViewContentLoaded();\r\n          unbindIncludeContentLoaded();\r\n          if (scrollId) {\r\n            delete spies[scrollId];\r\n          }\r\n        };\r\n\r\n        $scrollspy.checkPosition = function() {\r\n\r\n          // Not ready yet\r\n          if(!sortedElements.length) return;\r\n\r\n          // Calculate the scroll position\r\n          scrollTop = (isWindowSpy ? $window.pageYOffset : scrollEl.prop('scrollTop')) || 0;\r\n\r\n          // Calculate the viewport height for use by the components\r\n          viewportHeight = Math.max($window.innerHeight, docEl.prop('clientHeight'));\r\n\r\n          // Activate first element if scroll is smaller\r\n          if(scrollTop < sortedElements[0].offsetTop && activeTarget !== sortedElements[0].target) {\r\n            return $scrollspy.$activateElement(sortedElements[0]);\r\n          }\r\n\r\n          // Activate proper element\r\n          for (var i = sortedElements.length; i--;) {\r\n            if(angular.isUndefined(sortedElements[i].offsetTop) || sortedElements[i].offsetTop === null) continue;\r\n            if(activeTarget === sortedElements[i].target) continue;\r\n            if(scrollTop < sortedElements[i].offsetTop) continue;\r\n            if(sortedElements[i + 1] && scrollTop > sortedElements[i + 1].offsetTop) continue;\r\n            return $scrollspy.$activateElement(sortedElements[i]);\r\n          }\r\n\r\n        };\r\n\r\n        $scrollspy.checkPositionWithEventLoop = function() {\r\n          setTimeout(this.checkPosition, 1);\r\n        };\r\n\r\n        // Protected methods\r\n\r\n        $scrollspy.$activateElement = function(element) {\r\n          if(activeTarget) {\r\n            var activeElement = $scrollspy.$getTrackedElement(activeTarget);\r\n            if(activeElement) {\r\n              activeElement.source.removeClass('active');\r\n              if(nodeName(activeElement.source, 'li') && nodeName(activeElement.source.parent().parent(), 'li')) {\r\n                activeElement.source.parent().parent().removeClass('active');\r\n              }\r\n            }\r\n          }\r\n          activeTarget = element.target;\r\n          element.source.addClass('active');\r\n          if(nodeName(element.source, 'li') && nodeName(element.source.parent().parent(), 'li')) {\r\n            element.source.parent().parent().addClass('active');\r\n          }\r\n        };\r\n\r\n        $scrollspy.$getTrackedElement = function(target) {\r\n          return trackedElements.filter(function(obj) {\r\n            return obj.target === target;\r\n          })[0];\r\n        };\r\n\r\n        // Track offsets behavior\r\n\r\n        $scrollspy.checkOffsets = function() {\r\n\r\n          angular.forEach(trackedElements, function(trackedElement) {\r\n            var targetElement = document.querySelector(trackedElement.target);\r\n            trackedElement.offsetTop = targetElement ? dimensions.offset(targetElement).top : null;\r\n            if(options.offset && trackedElement.offsetTop !== null) trackedElement.offsetTop -= options.offset * 1;\r\n          });\r\n\r\n          sortedElements = trackedElements\r\n          .filter(function(el) {\r\n            return el.offsetTop !== null;\r\n          })\r\n          .sort(function(a, b) {\r\n            return a.offsetTop - b.offsetTop;\r\n          });\r\n\r\n          debouncedCheckPosition();\r\n\r\n        };\r\n\r\n        $scrollspy.trackElement = function(target, source) {\r\n          trackedElements.push({target: target, source: source});\r\n        };\r\n\r\n        $scrollspy.untrackElement = function(target, source) {\r\n          var toDelete;\r\n          for (var i = trackedElements.length; i--;) {\r\n            if(trackedElements[i].target === target && trackedElements[i].source === source) {\r\n              toDelete = i;\r\n              break;\r\n            }\r\n          }\r\n          trackedElements = trackedElements.splice(toDelete, 1);\r\n        };\r\n\r\n        $scrollspy.activate = function(i) {\r\n          trackedElements[i].addClass('active');\r\n        };\r\n\r\n        // Initialize plugin\r\n\r\n        $scrollspy.init();\r\n        return $scrollspy;\r\n\r\n      }\r\n\r\n      return ScrollSpyFactory;\r\n\r\n    };\r\n\r\n  })\r\n\r\n  .directive('bsScrollspy', function($rootScope, debounce, dimensions, $scrollspy) {\r\n\r\n    return {\r\n      restrict: 'EAC',\r\n      link: function postLink(scope, element, attr) {\r\n\r\n        var options = {scope: scope};\r\n        angular.forEach(['offset', 'target'], function(key) {\r\n          if(angular.isDefined(attr[key])) options[key] = attr[key];\r\n        });\r\n\r\n        var scrollspy = $scrollspy(options);\r\n        scrollspy.trackElement(options.target, element);\r\n\r\n        scope.$on('$destroy', function() {\r\n          scrollspy.untrackElement(options.target, element);\r\n          scrollspy.destroy();\r\n          options = null;\r\n          scrollspy = null;\r\n        });\r\n\r\n      }\r\n    };\r\n\r\n  })\r\n\r\n\r\n  .directive('bsScrollspyList', function($rootScope, debounce, dimensions, $scrollspy) {\r\n\r\n    return {\r\n      restrict: 'A',\r\n      compile: function postLink(element, attr) {\r\n        var children = element[0].querySelectorAll('li > a[href]');\r\n        angular.forEach(children, function(child) {\r\n          var childEl = angular.element(child);\r\n          childEl.parent().attr('bs-scrollspy', '').attr('data-target', childEl.attr('href'));\r\n        });\r\n      }\r\n\r\n    };\r\n\r\n  });\r\n"],"sourceRoot":"/source/"}