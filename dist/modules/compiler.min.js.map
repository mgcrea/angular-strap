{"version":3,"sources":["modules/compiler.js"],"names":["templateUrl","options","cache","$templateCache","then","element","res","fetchTemplate","template","fetchPromises","$http","get","data","this","compile","controller","console","controllerAs","resolve","copy","locals","bindToController","angular","forEach","value","isString","$injector","key","invoke","transformTemplate","identity","extend","$template","when","$q","all","templateEl","Error","findElement","contentTemplate","templates","contentEl","removeAttr","html","replace","next","remove","outerHTML","link","scope","trim","contents","linkFn","invokeCtrl","children","instance","ctrl","isObject","arguments","apply","bsCompilerService","warn","service"],"mappings":"AAOA,YAMA,SAgEQA,mBAAcC,EAAQD,EAAAA,EAAAA,EAAAA,EAAAA,GAU5B,QA+FyDE,GAAOC,EAAAA,GA9F9D,MA+FGC,SAAKC,SAAUC,GAAAA,UAAAA,iBAAAA,IA5FpB,QAASC,GAAcC,GACrB,MAAIC,GAAcD,GAAkBC,EAAcD,GAC3CC,EAAcD,GAAYE,EAAMC,IAAIH,GACzCN,MAAOC,IACNC,KAAK,SAASE,GACf,MAAOA,GAAIM,OAlFfC,KAgEEC,QAAIN,SAAWP,GACXc,EAAAA,UAAad,UAAQc,KAAAA,EAAAA,YACzBC,QAAIC,KAAAA,oGACJhB,EAAIiB,YAAkBC,EAAKlB,SAC3BA,EAAImB,SAAiBD,GAErB,IAAIE,GAAAA,EAAmBpB,YAKvBqB,EAAQC,EAAQL,UAAmBM,GACjCT,EAAYU,EAASD,WACnBN,EAAeQ,EAAAA,aAnEfR,EAoEKI,QAAAH,KAAAlB,EAAAiB,aACLA,EAAQS,QAAOD,KAAAA,EAAUE,YAnEzBC,EAAoB5B,EAAQ4B,mBAAqBP,QAAQQ,SACzDT,EAAmBpB,EAAQoB,gBAiF/B,IAVAC,QAAQS,QAAOb,EAASE,SAAAA,EAAAA,GAEpBZ,QAAUiB,SAAAD,GACZN,EAAQc,GAAAA,EAAeC,IAAKzB,GAE5BU,EAAQc,GAAAA,EAAYzB,OAAcP,KApEpCsB,QAAQS,OAAOb,EAASE,GAyEpBnB,EACFiB,EAAQc,UAAYE,EAAGC,KAAAA,OAEnB,CAAA,IAAIC,EAtER,KAAM,IAAIC,OAAM,6CAFhBnB,GAyEIoB,UAAY/B,EAAAP,GAtDlB,MA6DIC,GAAQsC,gBAEVrB,EAAQc,UAAYE,EAAGC,KAAKjB,EAAQc,UAAWzB,EAAcN,EAAQsC,iBAAAA,KAClEnC,SAAKoC,GACJ,GAAIJ,GAAad,QAAQjB,QAAQmC,EAAU,GAK3C,OAJAF,GAAIG,oBAAwBL,EAAA,IAAAM,WAAuBN,WAChDM,KAAAA,EAAW,IAGTzC,EAAQD,GAAAA,aA9EfC,EAAQsC,kBAoFZrB,EAAUiB,UAAIjB,EAASd,KAAKc,EAAUE,UAAAA,EAAAA,EAAAA,mBAAAA,KAAAA,SAAAA,GAEpC,GAAIZ,GAAWqB,QAAAA,QAAkBT,EAAOY,IACpC/B,EAAcqC,EAAA,sBAAAF,EAAA,IAAAM,WAAA,WAAAC,KAAAH,EAAA,GAlFhB,OAmFAhC,GAAWA,aAASoC,EAAQC,OAAeC,SAnFpCV,EAAW,GAAGW,aA0FvBb,EAAAC,IAAAjB,GAAAd,KAAA,SAAAgB,GAtFA,GAuFEA,GAAQA,EAAAA,EAAAA,UACRf,GAASA,OACT2C,EAAMxC,EAAeyC,QAAAA,cAAAA,kBArFvB,IAyFI5C,GAAIU,QAAYV,QAAA,SAAAsC,KAAAnC,EAAA0C,QAAAC,WAxFhBC,EAyFMC,EAAAA,EAxFV,QACEjC,OAyFME,EAxFNjB,QAASA,EACT2C,KA0FI,SAAW1B,GAxFb,GADAF,EA2FEf,OAAa4C,EACb5C,EAAQiD,CAER,GAAIrC,GAAAA,EAAcF,EAAAK,GAAA,EAChB6B,IA3FA3B,QAAQS,OAAOsB,EAAWE,SAAUnC,EA+FxC,IAAAoC,GAAOJ,QAAaK,SAAMC,GAAAA,EAAAA,GA5FxBrD,GAAQO,KAAK,0BAA2B4C,GACxCnD,EAAQiD,WAAW1C,KAAK,0BAA2B4C,GAC/CvC,IACFgC,EAAMhC,GAAgBuC,GAG1B,MAAOJ,GAAOO,MAAM,KAAMD,eAQlC,IAAIjD,MAjFNmD,kBA+DcC,SAAK,KAAA,QAAA,YAAA,WAAA,cAAA,kBA7DnBvC,QA+DMrB,OAAQO,0BAAWsD,QAAA,cAAAF","file":"compiler.min.js","sourcesContent":["'use strict';\n\n// NOTICE: This file was forked from the angular-material project (github.com/angular/material)\n// MIT Licensed - Copyright (c) 2014-2015 Google, Inc. http://angularjs.org\n\nangular.module('mgcrea.ngStrap.core', [])\n  .service('$bsCompiler', bsCompilerService);\n\nfunction bsCompilerService ($q, $http, $injector, $compile, $controller, $templateCache) {\n\n  /*\n   * @ngdoc service\n   * @name $bsCompiler\n   * @module material.core\n   * @description\n   * The $bsCompiler service is an abstraction of angular's compiler, that allows the developer\n   * to easily compile an element with a templateUrl, controller, and locals.\n   *\n   * @usage\n   * <hljs lang=\"js\">\n   * $bsCompiler.compile({\n   *   templateUrl: 'modal.html',\n   *   controller: 'ModalCtrl',\n   *   locals: {\n   *     modal: myModalInstance;\n   *   }\n   * }).then(function(compileData) {\n   *   compileData.element; // modal.html's template in an element\n   *   compileData.link(myScope); //attach controller & scope to element\n   * });\n   * </hljs>\n   */\n\n   /*\n    * @ngdoc method\n    * @name $bsCompiler#compile\n    * @description A helper to compile an HTML template/templateUrl with a given controller,\n    * locals, and scope.\n    * @param {object} options An options object, with the following properties:\n    *\n    *    - `controller` - `{(string=|function()=}` Controller fn that should be associated with\n    *      newly created scope or the name of a registered controller if passed as a string.\n    *    - `controllerAs` - `{string=}` A controller alias name. If present the controller will be\n    *      published to scope under the `controllerAs` name.\n    *    - `template` - `{string=}` An html template as a string.\n    *    - `templateUrl` - `{string=}` A path to an html template.\n    *    - `transformTemplate` - `{function(template)=}` A function which transforms the template after\n    *      it is loaded. It will be given the template string as a parameter, and should\n    *      return a a new string representing the transformed template.\n    *    - `resolve` - `{Object.<string, function>=}` - An optional map of dependencies which should\n    *      be injected into the controller. If any of these dependencies are promises, the compiler\n    *      will wait for them all to be resolved, or if one is rejected before the controller is\n    *      instantiated `compile()` will fail..\n    *      * `key` - `{string}`: a name of a dependency to be injected into the controller.\n    *      * `factory` - `{string|function}`: If `string` then it is an alias for a service.\n    *        Otherwise if function, then it is injected and the return value is treated as the\n    *        dependency. If the result is a promise, it is resolved before its value is\n    *        injected into the controller.\n    *\n    * @returns {object=} promise A promise, which will be resolved with a `compileData` object.\n    * `compileData` has the following properties:\n    *\n    *   - `element` - `{element}`: an uncompiled element matching the provided template.\n    *   - `link` - `{function(scope)}`: A link function, which, when called, will compile\n    *     the element and instantiate the provided controller (if given).\n    *   - `locals` - `{object}`: The locals which will be passed into the controller once `link` is\n    *     called. If `bindToController` is true, they will be coppied to the ctrl instead\n    *   - `bindToController` - `bool`: bind the locals to the controller, instead of passing them in.\n    */\n  this.compile = function (options) {\n\n    if (options.template && /\\.html$/.test(options.template)) {\n      console.warn('Deprecated use of `template` option to pass a file. Please use the `templateUrl` option instead.');\n      options.templateUrl = options.template;\n      options.template = '';\n    }\n\n    var templateUrl = options.templateUrl;\n    var template = options.template || '';\n    var controller = options.controller;\n    var controllerAs = options.controllerAs;\n    var resolve = angular.copy(options.resolve || {});\n    var locals = angular.copy(options.locals || {});\n    var transformTemplate = options.transformTemplate || angular.identity;\n    var bindToController = options.bindToController;\n\n    // Take resolve values and invoke them.\n    // Resolves can either be a string (value: 'MyRegisteredAngularConst'),\n    // or an invokable 'factory' of sorts: (value: function ValueGetter($dependency) {})\n    angular.forEach(resolve, function (value, key) {\n      if (angular.isString(value)) {\n        resolve[key] = $injector.get(value);\n      } else {\n        resolve[key] = $injector.invoke(value);\n      }\n    });\n    // Add the locals, which are just straight values to inject\n    // eg locals: { three: 3 }, will inject three into the controller\n    angular.extend(resolve, locals);\n\n    if (template) {\n      resolve.$template = $q.when(template);\n    } else if (templateUrl) {\n      resolve.$template = fetchTemplate(templateUrl);\n    } else {\n      throw new Error('Missing `template` / `templateUrl` option.');\n    }\n\n    if (options.titleTemplate) {\n      resolve.$template = $q.all([resolve.$template, fetchTemplate(options.titleTemplate)])\n        .then(function (templates) {\n          var templateEl = angular.element(templates[0]);\n          findElement('[ng-bind=\"title\"]', templateEl[0])\n            .removeAttr('ng-bind')\n            .html(templates[1]);\n          return templateEl[0].outerHTML;\n        });\n    }\n\n    if (options.contentTemplate) {\n      // TODO(mgcrea): deprecate?\n      resolve.$template = $q.all([resolve.$template, fetchTemplate(options.contentTemplate)])\n        .then(function (templates) {\n          var templateEl = angular.element(templates[0]);\n          var contentEl = findElement('[ng-bind=\"content\"]', templateEl[0])\n            .removeAttr('ng-bind')\n            .html(templates[1]);\n          // Drop the default footer as you probably don't want it if you use a custom contentTemplate\n          if (!options.templateUrl) contentEl.next().remove();\n          return templateEl[0].outerHTML;\n        });\n    }\n\n    // Wait for all the resolves to finish if they are promises\n    return $q.all(resolve).then(function (locals) {\n\n      var template = transformTemplate(locals.$template);\n      if (options.html) {\n        template = template.replace(/ng-bind=\"/ig, 'ng-bind-html=\"');\n      }\n      // var element = options.element || angular.element('<div>').html(template.trim()).contents();\n      var element = angular.element('<div>').html(template.trim()).contents();\n      var linkFn = $compile(element);\n\n      // Return a linking function that can be used later when the element is ready\n      return {\n        locals: locals,\n        element: element,\n        link: function link (scope) {\n          locals.$scope = scope;\n\n          // Instantiate controller if it exists, because we have scope\n          if (controller) {\n            var invokeCtrl = $controller(controller, locals, true);\n            if (bindToController) {\n              angular.extend(invokeCtrl.instance, locals);\n            }\n            // Support angular@~1.2 invokeCtrl\n            var ctrl = angular.isObject(invokeCtrl) ? invokeCtrl : invokeCtrl();\n            // See angular-route source for this logic\n            element.data('$ngControllerController', ctrl);\n            element.children().data('$ngControllerController', ctrl);\n\n            if (controllerAs) {\n              scope[controllerAs] = ctrl;\n            }\n          }\n\n          return linkFn.apply(null, arguments);\n        }\n      };\n    });\n\n  };\n\n  function findElement (query, element) {\n    return angular.element((element || document).querySelectorAll(query));\n  }\n\n  var fetchPromises = {};\n  function fetchTemplate (template) {\n    if (fetchPromises[template]) return fetchPromises[template];\n    return (fetchPromises[template] = $http.get(template, {cache: $templateCache})\n      .then(function (res) {\n        return res.data;\n      }));\n  }\n\n}\n"]}