{"version":3,"sources":["modules/dropdown.js"],"names":["angular","trigger","provider","container","this","defaults","keyboard","html","delay","placement","bodyEl","matchesSelector","DropdownFactory","$dropdown","options","element","config","onBodyClick","evt","directive","target","hide","extend","$onKeyDown","scope","keyCode","parent","tagName","toUpperCase","attr","$element","preventDefault","items","length","index","el","querySelectorAll","eq","click","call","removeClass","$onFocusOut","isUndefined","undefined","$window","document","inMenu","relatedTarget","body","stopPropagation","show","$timeout","forEach","value","$scope","parentEl","hasClass","addClass","$id","key","off","returnFocus","focus","destroy","prototype","webkitMatchesSelector","Element","mozMatchesSelector","msMatchesSelector","oMatchesSelector","tAttrs","nextSibling","nodeType","$sce","restrict","compile","template","templateUrl","parentNode","removeChild","falseValueRegExp","bsKey","isDefined","charAt","slice","test","$watch","newValue","oldValue","content","$eval","dropdown","bsShow","on","isString","match","$on"],"mappings":"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","file":"dropdown.min.js","sourcesContent":["'use strict';\r\n\r\nangular.module('mgcrea.ngStrap.dropdown', ['mgcrea.ngStrap.tooltip'])\r\n\r\n  .provider('$dropdown', function () {\r\n\r\n    var defaults = this.defaults = {\r\n      animation: 'am-fade',\r\n      prefixClass: 'dropdown',\r\n      prefixEvent: 'dropdown',\r\n      placement: 'bottom-left',\r\n      templateUrl: 'dropdown/dropdown.tpl.html',\r\n      trigger: 'click',\r\n      container: false,\r\n      keyboard: true,\r\n      html: false,\r\n      delay: 0\r\n    };\r\n\r\n    this.$get = function ($window, $rootScope, $tooltip, $timeout) {\r\n\r\n      var bodyEl = angular.element($window.document.body);\r\n      var matchesSelector = Element.prototype.matchesSelector || Element.prototype.webkitMatchesSelector || Element.prototype.mozMatchesSelector || Element.prototype.msMatchesSelector || Element.prototype.oMatchesSelector;\r\n\r\n      function DropdownFactory (element, config) {\r\n\r\n        var $dropdown = {};\r\n\r\n        // Common vars\r\n        var options = angular.extend({}, defaults, config);\r\n        /* var scope = */\r\n        $dropdown.$scope = options.scope && options.scope.$new() || $rootScope.$new();\r\n\r\n        $dropdown = $tooltip(element, options);\r\n        var parentEl = element.parent();\r\n\r\n        if (element && element[0] && element[0].tagName.toUpperCase() === 'BUTTON') {\r\n          element.attr('aria-haspopup', 'true');\r\n          element.attr('aria-expanded', 'false');\r\n        }\r\n\r\n        // Protected methods\r\n\r\n        $dropdown.$onKeyDown = function (evt) {\r\n          if (evt.keyCode === 9 || evt.keyCode === 27) {\r\n            $dropdown.hide(/27/.test(evt.keyCode));\r\n            return;\r\n          } else if ($dropdown.$element && (evt.keyCode === 38 || evt.keyCode === 40 || evt.keyCode === 32 || evt.keyCode === 13)) {\r\n            //$dropdown.$element.focus();\r\n\r\n            evt.preventDefault();\r\n            evt.stopPropagation();\r\n\r\n            // Retrieve active index\r\n            var items = angular.element($dropdown.$element[0].querySelectorAll('li:not(.divider) a'));\r\n            if (!items.length) return;\r\n            var index;\r\n            angular.forEach(items, function (el, i) {\r\n              if (matchesSelector && matchesSelector.call(el, '.active')) {\r\n                index = i;\r\n                angular.element(el).removeClass('active');\r\n              }\r\n            });\r\n\r\n            // Navigate with keyboard\r\n            if (evt.keyCode === 32 || evt.keyCode === 13) {\r\n              items.eq(index).click();\r\n            } else if (evt.keyCode === 38 && index > 0) index--;\r\n            else if (evt.keyCode === 38 && (angular.isUndefined(index) || index === 0)) index = items.length - 1;\r\n            else if (evt.keyCode === 40 && index < items.length - 1) index++;\r\n            else if (evt.keyCode === 40 && index === items.length - 1) index = 0;\r\n            else if (angular.isUndefined(index)) index = 0;\r\n            items.eq(index).addClass('active');\r\n            $dropdown.$element.attr('aria-activedescendant', items.eq(index).attr('id'));\r\n\t\t\titems.eq(index)[0].focus();\r\n          }\r\n        };\r\n\r\n        $dropdown.$onFocusOut = function (evt) {\r\n          // find out if the related target's parents contain the datepicker's $element\r\n          var inMenu = false;\r\n          var parent = angular.element(evt.relatedTarget);\r\n          while (parent !== undefined && parent.length && parent[0] !== $window.document.body) {\r\n            parent = parent.parent();\r\n            if (parent !== undefined && parent[0] === $dropdown.$element[0]) {\r\n              inMenu = true;\r\n              break;\r\n            } else {\r\n              inMenu = false;\r\n            }\r\n          }\r\n\r\n          if (!inMenu) {\r\n            $dropdown.hide();\r\n          } else {\r\n            evt.preventDefault();\r\n            evt.stopPropagation();\r\n          }\r\n        };\r\n\r\n        // Overrides\r\n\r\n        var show = $dropdown.show;\r\n        $dropdown.show = function () {\r\n          show();\r\n          // use timeout to hookup the events to prevent\r\n          // event bubbling from being processed imediately.\r\n          $timeout(function () {\r\n            // Set assistive technology properties\r\n            element.attr('aria-expanded', 'true');\r\n            if ($dropdown.$element) {\r\n              $dropdown.$element.attr('aria-activedescendant', '');\r\n              $dropdown.$element.attr('role', 'menu');\r\n              $dropdown.$element.attr('tabindex', '-1');\r\n            }\r\n            if (options.keyboard && $dropdown.$element) {\r\n              $dropdown.$element.on('keydown', $dropdown.$onKeyDown);\r\n              $dropdown.$element.on('focusout', $dropdown.$onFocusOut);\r\n            }\r\n\r\n            bodyEl.on('click', onBodyClick);\r\n\r\n            if ($dropdown.$element) {\r\n              var items = angular.element($dropdown.$element[0].querySelectorAll('li:not(.divider)'));\r\n              // <li> should have role=\"none\" as per SS-9603\r\n              items.attr('role', 'none');\r\n\r\n              angular.element($dropdown.$element[0].querySelectorAll('li.divider')).attr('role', 'seperator');\r\n\r\n              items = angular.element($dropdown.$element[0].querySelectorAll('li:not(.divider) a'));\r\n              items.attr('role', 'menuitem');\r\n              if (items.length && options.keyboard) {\r\n                // Dropdown menu items that are natively focusable need to have a tabindex of -1 per SS-9603\r\n                // Menu item ID's should be unique for aria-activedescendant\r\n                angular.forEach(items, function (value, key) {\r\n                  angular.element(value).attr('id', $dropdown.$scope.$id + '_menuitem_' + key);\r\n                  angular.element(value).attr('tabindex', '-1');\r\n                });\r\n              }\r\n            }\r\n          }, 0, false);\r\n          if (parentEl.hasClass('dropdown')) parentEl.addClass('open');\r\n        };\r\n\r\n        var hide = $dropdown.hide;\r\n        $dropdown.hide = function (returnFocus) {\r\n          if (!$dropdown.$isShown) return;\r\n\r\n          element.attr('aria-expanded', 'false');\r\n\r\n          if (options.keyboard && $dropdown.$element) {\r\n            $dropdown.$element.off('keydown', $dropdown.$onKeyDown);\r\n            $dropdown.$element.off('focusout', $dropdown.$onFocusOut);\r\n          }\r\n\r\n          bodyEl.off('click', onBodyClick);\r\n          if (parentEl.hasClass('dropdown')) parentEl.removeClass('open');\r\n          $timeout(function () {\r\n            hide();\r\n            if (returnFocus) {\r\n              $timeout(function () {\r\n                if (element && element[0]) {\r\n                  element[0].focus();\r\n                }\r\n              }, 0, false);\r\n            }\r\n          }, 200);\r\n        };\r\n\r\n        var destroy = $dropdown.destroy;\r\n        $dropdown.destroy = function () {\r\n          bodyEl.off('click', onBodyClick);\r\n          destroy();\r\n        };\r\n\r\n        // Private functions\r\n\r\n        function onBodyClick (evt) {\r\n          if (evt.target === element[0]) return undefined;\r\n          return evt.target !== element[0] && $dropdown.hide();\r\n        }\r\n\r\n        return $dropdown;\r\n\r\n      }\r\n\r\n      return DropdownFactory;\r\n\r\n    };\r\n\r\n  })\r\n\r\n  .directive('bsDropdown', function ($window, $sce, $dropdown) {\r\n\r\n    return {\r\n      restrict: 'EAC',\r\n      scope: true,\r\n      compile: function (tElement, tAttrs) {\r\n\r\n        // Support for inlined template (next sibling)\r\n        // It must be fetched before compilation\r\n        if (!tAttrs.bsDropdown) {\r\n          var nextSibling = tElement[0].nextSibling;\r\n          while (nextSibling && nextSibling.nodeType !== 1) {\r\n            nextSibling = nextSibling.nextSibling;\r\n          }\r\n          if (nextSibling && nextSibling.className.split(' ').indexOf('dropdown-menu') >= 0) {\r\n            tAttrs.template = nextSibling.outerHTML;\r\n            tAttrs.templateUrl = undefined;\r\n            nextSibling.parentNode.removeChild(nextSibling);\r\n          }\r\n        }\r\n\r\n        return function postLink (scope, element, attr) {\r\n\r\n          // Directive options\r\n          var options = {\r\n            scope: scope\r\n          };\r\n          angular.forEach(['template', 'templateUrl', 'controller', 'controllerAs', 'placement', 'container', 'delay', 'trigger', 'keyboard', 'html', 'animation', 'id', 'autoClose'], function (key) {\r\n            if (angular.isDefined(tAttrs[key])) options[key] = tAttrs[key];\r\n          });\r\n\r\n          // use string regex match boolean attr falsy values, leave truthy values be\r\n          var falseValueRegExp = /^(false|0|)$/i;\r\n          angular.forEach(['html', 'container'], function (key) {\r\n            if (angular.isDefined(attr[key]) && falseValueRegExp.test(attr[key])) options[key] = false;\r\n          });\r\n\r\n          // bind functions from the attrs to the show and hide events\r\n          angular.forEach(['onBeforeShow', 'onShow', 'onBeforeHide', 'onHide'], function (key) {\r\n            var bsKey = 'bs' + key.charAt(0).toUpperCase() + key.slice(1);\r\n            if (angular.isDefined(attr[bsKey])) {\r\n              options[key] = scope.$eval(attr[bsKey]);\r\n            }\r\n          });\r\n\r\n          // Support scope as an object\r\n          if (attr.bsDropdown) {\r\n            scope.$watch(attr.bsDropdown, function (newValue, oldValue) {\r\n              scope.content = newValue;\r\n            }, true);\r\n          }\r\n\r\n          // Initialize dropdown\r\n          var dropdown = $dropdown(element, options);\r\n\r\n          // Pickup key press on the dropdown button\r\n          element.on('keydown',function (evt) {\r\n            if (evt.keyCode === 38 || evt.keyCode === 40 || evt.keyCode === 27 || evt.keyCode === 9) {\r\n              dropdown.$onKeyDown(evt);\r\n            }\r\n          });\r\n\r\n          // Visibility binding support\r\n          if (attr.bsShow) {\r\n            scope.$watch(attr.bsShow, function (newValue, oldValue) {\r\n              if (!dropdown || !angular.isDefined(newValue)) return;\r\n              if (angular.isString(newValue)) newValue = !!newValue.match(/true|,?(dropdown),?/i);\r\n              if (newValue === true) {\r\n                dropdown.show();\r\n              } else {\r\n                dropdown.hide();\r\n              }\r\n            });\r\n          }\r\n\r\n          // Garbage collection\r\n          scope.$on('$destroy', function () {\r\n            if (dropdown) dropdown.destroy();\r\n            options = null;\r\n            dropdown = null;\r\n          });\r\n\r\n        };\r\n      }\r\n    };\r\n\r\n  });\r\n"]}