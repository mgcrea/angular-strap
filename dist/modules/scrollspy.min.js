/**
 * angular-strap
 * @version v2.0.0-beta.4 - 2014-01-20
 * @link http://mgcrea.github.io/angular-strap
 * @author Olivier Louvignes <olivier@mg-crea.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("mgcrea.ngStrap.scrollspy",["mgcrea.ngStrap.helpers.debounce","mgcrea.ngStrap.helpers.dimensions"]).provider("$scrollspy",function(){var a=this.$$spies={},b=this.defaults={debounce:150,throttle:100,offset:100};this.$get=["$window","$document","$rootScope","dimensions","debounce","throttle",function(c,d,e,f,g,h){function i(a,b){return a[0].nodeName&&a[0].nodeName.toLowerCase()===b.toLowerCase()}function j(d){var j=angular.extend({},b,d);j.element||(j.element=m);var n=i(j.element,"body"),o=n?k:j.element,p=n?"window":j.id;if(a[p])return a[p].$$count++,a[p];var q,r,s,t,u,v,w={},x=w.$trackedElements=[],y=[];return w.init=function(){this.$$count=1,r=g(this.checkPosition,j.debounce),s=h(this.checkPosition,j.throttle),o.on("click",this.checkPositionWithEventLoop),k.on("resize",r),o.on("scroll",s),t=g(this.checkOffsets,j.debounce),e.$on("$viewContentLoaded",t),e.$on("$includeContentLoaded",t),t(),p&&(a[p]=w)},w.destroy=function(){this.$$count--,this.$$count>0||(o.off("click",this.checkPositionWithEventLoop),k.off("resize",r),o.off("scroll",r),e.$off("$viewContentLoaded",t),e.$off("$includeContentLoaded",t))},w.checkPosition=function(){if(y.length){if(v=(n?c.pageYOffset:o.prop("scrollTop"))||0,u=Math.max(c.innerHeight,l.prop("clientHeight")),v<y[0].offsetTop&&q!==y[0].target)return w.$activateElement(y[0]);for(var a=y.length;a--;)if(!angular.isUndefined(y[a].offsetTop)&&null!==y[a].offsetTop&&q!==y[a].target&&!(v<y[a].offsetTop||y[a+1]&&v>y[a+1].offsetTop))return w.$activateElement(y[a])}},w.checkPositionWithEventLoop=function(){setTimeout(this.checkPosition,1)},w.$activateElement=function(a){if(q){var b=w.$getTrackedElement(q);b&&(b.source.removeClass("active"),i(b.source,"li")&&i(b.source.parent().parent(),"li")&&b.source.parent().parent().removeClass("active"))}q=a.target,a.source.addClass("active"),i(a.source,"li")&&i(a.source.parent().parent(),"li")&&a.source.parent().parent().addClass("active")},w.$getTrackedElement=function(a){return x.filter(function(b){return b.target===a})[0]},w.checkOffsets=function(){angular.forEach(x,function(a){var b=document.querySelector(a.target);a.offsetTop=b?f.offset(b).top:null,j.offset&&null!==a.offsetTop&&(a.offsetTop-=1*j.offset)}),y=x.filter(function(a){return null!==a.offsetTop}).sort(function(a,b){return a.offsetTop-b.offsetTop}),r()},w.trackElement=function(a,b){x.push({target:a,source:b})},w.untrackElement=function(a,b){for(var c,d=x.length;d--;)if(x[d].target===a&&x[d].source===b){c=d;break}x=x.splice(c,1)},w.activate=function(a){x[a].addClass("active")},w.init(),w}var k=angular.element(c),l=angular.element(d.prop("documentElement")),m=angular.element(c.document.body);return j}]}).directive("bsScrollspy",["$rootScope","debounce","dimensions","$scrollspy",function(a,b,c,d){return{restrict:"EAC",link:function(a,b,c){var e={scope:a};angular.forEach(["offset","target"],function(a){angular.isDefined(c[a])&&(e[a]=c[a])});var f=d(e);f.trackElement(e.target,b),a.$on("$destroy",function(){f.untrackElement(e.target,b),f.destroy(),e=null,f=null})}}}]).directive("bsScrollspyList",["$rootScope","debounce","dimensions","$scrollspy",function(){return{restrict:"A",compile:function(a){var b=a[0].querySelectorAll("li > a[href]");angular.forEach(b,function(a){var b=angular.element(a);b.parent().attr("bs-scrollspy","").attr("data-target",b.attr("href"))})}}}]);
//# sourceMappingURL=angular-strap.min.map