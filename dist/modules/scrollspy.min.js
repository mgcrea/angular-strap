/**
 * angular-strap
 * @version v2.0.0-rc.4 - 2014-04-03
 * @link http://mgcrea.github.io/angular-strap
 * @author Olivier Louvignes (olivier@mg-crea.com)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("mgcrea.ngStrap.scrollspy",["mgcrea.ngStrap.helpers.debounce","mgcrea.ngStrap.helpers.dimensions"]).provider("$scrollspy",function(){var a=this.$$spies={},b=this.defaults={debounce:150,throttle:100,offset:100};this.$get=["$window","$document","$rootScope","dimensions","debounce","throttle",function(c,d,e,f,g,h){function i(a,b){return a[0].nodeName&&a[0].nodeName.toLowerCase()===b.toLowerCase()}function j(d){var j=angular.extend({},b,d);j.element||(j.element=m);var n=i(j.element,"body"),o=n?k:j.element,p=n?"window":j.id;if(a[p])return a[p].$$count++,a[p];var q,r,s,t,u,v,w,x,y={},z=y.$trackedElements=[],A=[];return y.init=function(){this.$$count=1,t=g(this.checkPosition,j.debounce),u=h(this.checkPosition,j.throttle),o.on("click",this.checkPositionWithEventLoop),k.on("resize",t),o.on("scroll",u),v=g(this.checkOffsets,j.debounce),q=e.$on("$viewContentLoaded",v),r=e.$on("$includeContentLoaded",v),v(),p&&(a[p]=y)},y.destroy=function(){this.$$count--,this.$$count>0||(o.off("click",this.checkPositionWithEventLoop),k.off("resize",t),o.off("scroll",t),q(),r(),p&&delete a[p])},y.checkPosition=function(){if(A.length){if(x=(n?c.pageYOffset:o.prop("scrollTop"))||0,w=Math.max(c.innerHeight,l.prop("clientHeight")),x<A[0].offsetTop&&s!==A[0].target)return y.$activateElement(A[0]);for(var a=A.length;a--;)if(!angular.isUndefined(A[a].offsetTop)&&null!==A[a].offsetTop&&s!==A[a].target&&!(x<A[a].offsetTop||A[a+1]&&x>A[a+1].offsetTop))return y.$activateElement(A[a])}},y.checkPositionWithEventLoop=function(){setTimeout(this.checkPosition,1)},y.$activateElement=function(a){if(s){var b=y.$getTrackedElement(s);b&&(b.source.removeClass("active"),i(b.source,"li")&&i(b.source.parent().parent(),"li")&&b.source.parent().parent().removeClass("active"))}s=a.target,a.source.addClass("active"),i(a.source,"li")&&i(a.source.parent().parent(),"li")&&a.source.parent().parent().addClass("active")},y.$getTrackedElement=function(a){return z.filter(function(b){return b.target===a})[0]},y.checkOffsets=function(){angular.forEach(z,function(a){var b=document.querySelector(a.target);a.offsetTop=b?f.offset(b).top:null,j.offset&&null!==a.offsetTop&&(a.offsetTop-=1*j.offset)}),A=z.filter(function(a){return null!==a.offsetTop}).sort(function(a,b){return a.offsetTop-b.offsetTop}),t()},y.trackElement=function(a,b){z.push({target:a,source:b})},y.untrackElement=function(a,b){for(var c,d=z.length;d--;)if(z[d].target===a&&z[d].source===b){c=d;break}z=z.splice(c,1)},y.activate=function(a){z[a].addClass("active")},y.init(),y}var k=angular.element(c),l=angular.element(d.prop("documentElement")),m=angular.element(c.document.body);return j}]}).directive("bsScrollspy",["$rootScope","debounce","dimensions","$scrollspy",function(a,b,c,d){return{restrict:"EAC",link:function(a,b,c){var e={scope:a};angular.forEach(["offset","target"],function(a){angular.isDefined(c[a])&&(e[a]=c[a])});var f=d(e);f.trackElement(e.target,b),a.$on("$destroy",function(){f.untrackElement(e.target,b),f.destroy(),e=null,f=null})}}}]).directive("bsScrollspyList",["$rootScope","debounce","dimensions","$scrollspy",function(){return{restrict:"A",compile:function(a){var b=a[0].querySelectorAll("li > a[href]");angular.forEach(b,function(a){var b=angular.element(a);b.parent().attr("bs-scrollspy","").attr("data-target",b.attr("href"))})}}}]);
//# sourceMappingURL=scrollspy.min.map