{"version":3,"file":"modal.min.js","sources":["modal/modal.js"],"names":[],"mappings":"qBASM,OAAA,wBAAA,+CAEA,SAAA,cAEA,GAAA,KAAA,UACA,UAAA,UACA,kBAAA,UACA,YAAA,QACA,YAAA,QACA,UAAA,MACA,SAAA,uBACF,iBAAA,eAEA,QAAA,iBAEE,UAAA,EACA,MAAA,EACA,MAAA,4JAWE,GAAA,GA+LF,QAAA,GAAA,gCAEA,WAAA,EAAA,SAAA,EAAA,QAAA,EAAA,WA/LI,MAGF,EAAA,EAAA,SAAA,QAAA,UAAA,EAAA,EACA,GAAA,SAAA,EAAA,EAAA,aACE,GAAA,EAAA,OAAA,EAAA,OAAA,EAAA,MAAA,QAAA,EAAA,MACF,GAAA,SAAA,EAAA,mCAKI,QAAA,WAAA,SAAA,GACF,EAAA,KAAA,EAAA,GAAA,EAAA,YAAA,EAAA,SAIE,MAAA,WACF,EAAA,aAAA,WACF,EAAA,YAGI,MAAA,WACF,EAAA,aAAA,WACF,EAAA,UAGA,EAAA,QAAA,WACE,EAAA,aAAA,WACE,EAAA,cAKE,oBACA,SAAA,EAAA,SAAA,KAAA,SAAA,GACF,GAAA,GAAA,QAAA,QAAA,EACF,OAAA,GAAA,EAAA,iBACF,KAAA,SAAA,oEAIA,OADA,GAAA,UAAA,EAAA,OAAA,SACA,EAAA,GAAA,kBAME,GAAA,EACF,EAAA,QAAA,QAAA,eAAA,EAAA,YAAA,eAkJA,oCAhJA,QAAA,SAAA,KAAA,EAAA,EAAA,gDAEE,EAAA,EAAA,MAAA,GACA,EAAA,EAAA,KACE,WAGF,KAAA,mBAIF,EAAA,aAAA,yBAOE,QAAA,WAGA,eAEA,EAAA,UAGF,EAAA,iBAKE,EAAA,cAIE,KAAA,WAEF,EAAA,MAAA,EAAA,YAAA,eAAA,QAGA,GADA,QAAA,UAAA,EAAA,WACA,EAAA,UAEA,EAAA,UAAA,EAAA,EAAA,WAAA,wCAKE,EAAA,SAAA,EAAA,EAAA,gBAGA,KAAA,QAAA,UAAA,SAAA,EAAA,WAGF,EAAA,YACE,EAAA,UACF,EAAA,SAAA,EAAA,mBAEE,EAAA,SAAA,EAAA,YAGF,EAAA,UACA,EAAA,MAAA,EAAA,EAAA,KAAA,cAEA,EAAA,MAAA,EAAA,EAAA,EAAA,WACA,EAAA,MAAA,EAAA,YAAA,QAAA,KAEA,EAAA,UAAA,sDAIE,GAAA,EAAA,EACF,GAAA,yBAIE,SAAA,EAAA,YAAA,SACA,EAAA,WACF,EAAA,SAAA,EAAA,YAAA,SAAA,EAAA,WAIF,EAAA,2BAEA,EAAA,GAAA,QAAA,IAEE,EAAA,UACA,EAAA,GAAA,QAAA,EAAA,aAII,KAAA,WAEJ,EAAA,MAAA,EAAA,YAAA,eAAA,GACA,EAAA,MAAA,EAAA,WACE,EAAA,MAAA,EAAA,YAAA,QAAA,GACF,EAAA,YAAA,EAAA,YAAA,SACA,EAAA,WACA,EAAA,YAAA,EAAA,YAAA,SAAA,EAAA,aAGA,EAAA,UACE,EAAA,MAAA,EAAA,cAEF,EAAA,UAAA,EACA,EAAA,SAAA,EAAA,OAAA,EAAA,MAAA,SAAA,EAAA,UAGF,EAAA,4BAEA,EAAA,IAAA,QAAA,IAEE,EAAA,uCAKA,OAAA,4DAOA,EAAA,GAAA,SAKF,EAAA,SAAA,SAAA,GAEA,KAAA,EAAA,OAAA,EAAA,oBAEA,EAAA,oBAYA,UAME,GAAA,EAAA,SACE,SAAA,SAAA,GAAA,UAAA,iBAAA,YAGF,GAAA,GACF,MAAA,GAAA,KAAA,EAAA,IAAA,IAAA,EAAA,IAAA,IACF,KAAA,SAAA,+BAEA,EAAA,IAAA,EAAA,EAAA,wCAvNE,EAAA,OAAA,UAAA,6CAEA,EAAA,QAAA,QAAA,EAAA,SAAA,MACA,EAAA,qCAiOA,WAAA,UAAA,OAAA,SAAA,SAAA,EAAA,EAAA,mBAGE,aACF,0BAIE,IAAA,MAAA,EAAA,QAAA,EAAA,MAAA,WACE,SAAA,WAAA,kBAAA,YAAA,WAAA,WAAA,OAAA,YAAA,aAAA,SAAA,GACF,QAAA,UAAA,EAAA,MAAA,EAAA,GAAA,EAAA,MAIF,QAAA,SAAA,QAAA,WAAA,SAAA,GACE,EAAA,IAAA,EAAA,SAAA,EAAA,SAAA,GACE,EAAA,GAAA,EAAA,YAAA,iDAMJ,QAAA,SAAA,GACA,QAAA,OAAA,EAAA,GAEA,EAAA,QAAA,UAKE,GAAA,EAAA,EAGF,GAAA,GAAA,EAAA,SAAA,QAAA,EAAA,QAGJ,EAAA,IAAA,WAAA,0BAED,EAAA","sourcesContent":["'use strict';\n\nangular.module('mgcrea.ngStrap.modal', ['mgcrea.ngStrap.helpers.dimensions'])\n\n  .provider('$modal', function() {\n\n    var defaults = this.defaults = {\n      animation: 'am-fade',\n      backdropAnimation: 'am-fade',\n      prefixClass: 'modal',\n      prefixEvent: 'modal',\n      placement: 'top',\n      template: 'modal/modal.tpl.html',\n      contentTemplate: false,\n      container: false,\n      element: null,\n      backdrop: true,\n      keyboard: true,\n      html: false,\n      show: true\n    };\n\n    this.$get = function($window, $rootScope, $compile, $q, $templateCache, $http, $animate, $timeout, $sce, dimensions) {\n\n      var forEach = angular.forEach;\n      var trim = String.prototype.trim;\n      var requestAnimationFrame = $window.requestAnimationFrame || $window.setTimeout;\n      var bodyElement = angular.element($window.document.body);\n      var htmlReplaceRegExp = /ng-bind=\"/ig;\n\n      function ModalFactory(config) {\n\n        var $modal = {};\n\n        // Common vars\n        var options = $modal.$options = angular.extend({}, defaults, config);\n        $modal.$promise = fetchTemplate(options.template);\n        var scope = $modal.$scope = options.scope && options.scope.$new() || $rootScope.$new();\n        if(!options.element && !options.container) {\n          options.container = 'body';\n        }\n\n        // Support scope as string options\n        forEach(['title', 'content'], function(key) {\n          if(options[key]) scope[key] = $sce.trustAsHtml(options[key]);\n        });\n\n        // Provide scope helpers\n        scope.$hide = function() {\n          scope.$$postDigest(function() {\n            $modal.hide();\n          });\n        };\n        scope.$show = function() {\n          scope.$$postDigest(function() {\n            $modal.show();\n          });\n        };\n        scope.$toggle = function() {\n          scope.$$postDigest(function() {\n            $modal.toggle();\n          });\n        };\n\n        // Support contentTemplate option\n        if(options.contentTemplate) {\n          $modal.$promise = $modal.$promise.then(function(template) {\n            var templateEl = angular.element(template);\n            return fetchTemplate(options.contentTemplate)\n            .then(function(contentTemplate) {\n              var contentEl = findElement('[ng-bind=\"content\"]', templateEl[0]).removeAttr('ng-bind').html(contentTemplate);\n              // Drop the default footer as you probably don't want it if you use a custom contentTemplate\n              if(!config.template) contentEl.next().remove();\n              return templateEl[0].outerHTML;\n            });\n          });\n        }\n\n        // Fetch, compile then initialize modal\n        var modalLinker, modalElement;\n        var backdropElement = angular.element('<div class=\"' + options.prefixClass + '-backdrop\"/>');\n        $modal.$promise.then(function(template) {\n          if(angular.isObject(template)) template = template.data;\n          if(options.html) template = template.replace(htmlReplaceRegExp, 'ng-bind-html=\"');\n          template = trim.apply(template);\n          modalLinker = $compile(template);\n          $modal.init();\n        });\n\n        $modal.init = function() {\n\n          // Options: show\n          if(options.show) {\n            scope.$$postDigest(function() {\n              $modal.show();\n            });\n          }\n\n        };\n\n        $modal.destroy = function() {\n\n          // Remove element\n          if(modalElement) {\n            modalElement.remove();\n            modalElement = null;\n          }\n          if(backdropElement) {\n            backdropElement.remove();\n            backdropElement = null;\n          }\n\n          // Destroy scope\n          scope.$destroy();\n\n        };\n\n        $modal.show = function() {\n\n          scope.$emit(options.prefixEvent + '.show.before', $modal);\n          var parent;\n          if(angular.isElement(options.container)) {\n            parent = options.container;\n          } else {\n            parent = options.container ? findElement(options.container) : null;\n          }\n          var after = options.container ? null : options.element;\n\n          // Fetch a cloned element linked from template\n          modalElement = $modal.$element = modalLinker(scope, function(clonedElement, scope) {});\n\n          // Set the initial positioning.\n          modalElement.css({display: 'block'}).addClass(options.placement);\n\n          // Options: animation\n          if(options.animation) {\n            if(options.backdrop) {\n              backdropElement.addClass(options.backdropAnimation);\n            }\n            modalElement.addClass(options.animation);\n          }\n\n          if(options.backdrop) {\n            $animate.enter(backdropElement, bodyElement, null, function() {});\n          }\n          $animate.enter(modalElement, parent, after, function() {\n            scope.$emit(options.prefixEvent + '.show', $modal);\n          });\n          scope.$isShown = true;\n          scope.$$phase || (scope.$root && scope.$root.$$phase) || scope.$digest();\n          // Focus once the enter-animation has started\n          // Weird PhantomJS bug hack\n          var el = modalElement[0];\n          requestAnimationFrame(function() {\n            el.focus();\n          });\n\n          bodyElement.addClass(options.prefixClass + '-open');\n          if(options.animation) {\n            bodyElement.addClass(options.prefixClass + '-with-' + options.animation);\n          }\n\n          // Bind events\n          if(options.backdrop) {\n            modalElement.on('click', hideOnBackdropClick);\n            backdropElement.on('click', hideOnBackdropClick);\n          }\n          if(options.keyboard) {\n            modalElement.on('keyup', $modal.$onKeyUp);\n          }\n        };\n\n        $modal.hide = function() {\n\n          scope.$emit(options.prefixEvent + '.hide.before', $modal);\n          $animate.leave(modalElement, function() {\n            scope.$emit(options.prefixEvent + '.hide', $modal);\n            bodyElement.removeClass(options.prefixClass + '-open');\n            if(options.animation) {\n              bodyElement.removeClass(options.prefixClass + '-with-' + options.animation);\n            }\n          });\n          if(options.backdrop) {\n            $animate.leave(backdropElement, function() {});\n          }\n          scope.$isShown = false;\n          scope.$$phase || (scope.$root && scope.$root.$$phase) || scope.$digest();\n\n          // Unbind events\n          if(options.backdrop) {\n            modalElement.off('click', hideOnBackdropClick);\n            backdropElement.off('click', hideOnBackdropClick);\n          }\n          if(options.keyboard) {\n            modalElement.off('keyup', $modal.$onKeyUp);\n          }\n        };\n\n        $modal.toggle = function() {\n\n          scope.$isShown ? $modal.hide() : $modal.show();\n\n        };\n\n        $modal.focus = function() {\n          modalElement[0].focus();\n        };\n\n        // Protected methods\n\n        $modal.$onKeyUp = function(evt) {\n\n          if (evt.which === 27 && scope.$isShown) {\n            $modal.hide();\n            evt.stopPropagation();\n          }\n\n        };\n\n        // Private methods\n\n        function hideOnBackdropClick(evt) {\n          if(evt.target !== evt.currentTarget) return;\n          options.backdrop === 'static' ? $modal.focus() : $modal.hide();\n        }\n\n        return $modal;\n\n      }\n\n      // Helper functions\n\n      function findElement(query, element) {\n        return angular.element((element || document).querySelectorAll(query));\n      }\n\n      function fetchTemplate(template) {\n        return $q.when($templateCache.get(template) || $http.get(template))\n        .then(function(res) {\n          if(angular.isObject(res)) {\n            $templateCache.put(template, res.data);\n            return res.data;\n          }\n          return res;\n        });\n      }\n\n      return ModalFactory;\n\n    };\n\n  })\n\n  .directive('bsModal', function($window, $sce, $modal) {\n\n    return {\n      restrict: 'EAC',\n      scope: true,\n      link: function postLink(scope, element, attr, transclusion) {\n\n        // Directive options\n        var options = {scope: scope, element: element, show: false};\n        angular.forEach(['template', 'contentTemplate', 'placement', 'backdrop', 'keyboard', 'html', 'container', 'animation'], function(key) {\n          if(angular.isDefined(attr[key])) options[key] = attr[key];\n        });\n\n        // Support scope as data-attrs\n        angular.forEach(['title', 'content'], function(key) {\n          attr[key] && attr.$observe(key, function(newValue, oldValue) {\n            scope[key] = $sce.trustAsHtml(newValue);\n          });\n        });\n\n        // Support scope as an object\n        attr.bsModal && scope.$watch(attr.bsModal, function(newValue, oldValue) {\n          if(angular.isObject(newValue)) {\n            angular.extend(scope, newValue);\n          } else {\n            scope.content = newValue;\n          }\n        }, true);\n\n        // Initialize modal\n        var modal = $modal(options);\n\n        // Trigger\n        element.on(attr.trigger || 'click', modal.toggle);\n\n        // Garbage collection\n        scope.$on('$destroy', function() {\n          if (modal) modal.destroy();\n          options = null;\n          modal = null;\n        });\n\n      }\n    };\n\n  });\n"],"sourceRoot":"/source/"}